<!doctype html>
<html class="no-js" lang="">

<head>
    <meta charset="utf-8">
    <title>Cannex Technical Test</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#fafafa">
    <style type="text/css">
        body {
            width: 1000px;        
        }
        input[type=text] {
            font-family: 'Consolas', monospace;
            font-size: 1.1em;
            padding: .03em;
            text-align: left;
            width: 600px;
        }

        .form-field {
            display: flex;
            justify-content: space-between;
            width: 76%;
            margin: .5rem;
        }

        .btn {
            -moz-box-shadow: 0px 1px 0px 0px #f0f7fa;
            -webkit-box-shadow: 0px 1px 0px 0px #f0f7fa;
            box-shadow: 0px 1px 0px 0px #f0f7fa;
            background: -webkit-gradient(linear, left top, left bottom, color-stop(0.05, #33bdef), color-stop(1, #019ad2));
            background: -moz-linear-gradient(top, #33bdef 5%, #019ad2 100%);
            background: -webkit-linear-gradient(top, #33bdef 5%, #019ad2 100%);
            background: -o-linear-gradient(top, #33bdef 5%, #019ad2 100%);
            background: -ms-linear-gradient(top, #33bdef 5%, #019ad2 100%);
            background: linear-gradient(to bottom, #33bdef 5%, #019ad2 100%);
            filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#33bdef', endColorstr='#019ad2', GradientType=0);
            background-color: #33bdef;
            -moz-border-radius: 6px;
            -webkit-border-radius: 6px;
            border-radius: 6px;
            border: 1px solid #057fd0;
            display: inline-block;
            cursor: pointer;
            color: #ffffff;
            font-family: Arial;
            font-size: 15px;
            font-weight: bold;
            padding: 6px 24px;
            text-decoration: none;
            text-shadow: 0px -1px 0px #5b6178;
        }

        .btn:hover {
            background: -webkit-gradient(linear, left top, left bottom, color-stop(0.05, #019ad2), color-stop(1, #33bdef));
            background: -moz-linear-gradient(top, #019ad2 5%, #33bdef 100%);
            background: -webkit-linear-gradient(top, #019ad2 5%, #33bdef 100%);
            background: -o-linear-gradient(top, #019ad2 5%, #33bdef 100%);
            background: -ms-linear-gradient(top, #019ad2 5%, #33bdef 100%);
            background: linear-gradient(to bottom, #019ad2 5%, #33bdef 100%);
            filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#019ad2', endColorstr='#33bdef', GradientType=0);
            background-color: #019ad2;
        }

        .btn:active {
            position: relative;
            top: 1px;
        }
    </style>
</head>

<body>
    <!--[if IE]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
    <![endif]-->

    <h1>Toronto Public Library</h1>
    <p class="notification"><mark>NOTIFICATION(S): <span id="notifications"></span></mark></p>
    <hr />

    <h3>Add Book</h3>
    <div class="form-field"><label for="input-book-title">Book title:</label><input type="text" id="input-book-title"></div>
    <div class="form-field"><label for="input-book-year">Year pubished:</label><input type="text" id="input-book-year"></div>
    <button id="btn-add-book" class="btn">Add Book</button>
    <button id="btn-save-book" class="btn" style="display: none;">Save</button>
    <button id="btn-cancel-book" class="btn" style="display: none;">Cancel</button>
    <h3 id="title-all-books">All Books</h3>
    <p id="books"></p>
    <hr />
    
    <h3 id="title-all-authors">All Authors</h3>
    <p id="authors"></p>
    <hr />

    <h3 id="title-all-libraries">All Libraries</h3>
    <p id="libraries"></p>

    <hr />

    <h3 id="title-all-library-books">All Books in Libraries</h3>
    <p id="library-books"></p>

    <script type="text/javascript">

        const ALL_BOOKS = 'All Books';
        const ALL_LIBRARIES = 'All Libraries';
        const ALL_AUTHORS = 'All Authors';
        const ALL_BOOKS_IN_LIBRARIES = 'All Books in Libraries';

        // write the result into the HTML
        var notifications = document.getElementById('notifications');
        // input fields
        var inputBookTitle = document.getElementById('input-book-title');
        var inputBookYear = document.getElementById('input-book-year');
        // buttons  
        var btnAddBook = document.getElementById('btn-add-book');
        btnAddBook.onclick = onAddBook;
        var btnSaveBook = document.getElementById('btn-save-book');
        btnSaveBook.onclick = onSaveBook;
        var btnCancelBook = document.getElementById('btn-cancel-book');
        btnCancelBook.onclick = onCancelBook;
        var editIndex = -1;

        window.addEventListener('load', init, false);

        function init() {
            displayBooks();
            displayLibraries();
            displayAuthors();
            displayLibraryBooks();
        }

        function displayBooks() {
            var txt = '';
            txt += '<table border="1">';
            txt += '<tr><th>ID</th><th>Title</th><th>Classification</th><th>Author</th><th>Year</th><th>Actions</th></tr>';
            var i = 0;
            for (x in dataBooks) {
                let authors = dataBooks[x].author.map(y => `${dataAuthor[y - 1].firstName} ${dataAuthor[y - 1].lastName}`);
                txt += `<tr><td>${dataBooks[x].id}</td><td>${dataBooks[x].title}</td><td>${dataBooks[x].classification.join(', ')}</td><td>${authors.join(', ')}</td><td align="right">${dataBooks[x].yearPublished}</td><td><button onclick="onEditBook('${i}');">Edit</button> <button onclick="onDeleteBook('${i}');">Delete</button></td></tr>`;
                i++;
            }
            txt += '</table>';
            document.getElementById('books').innerHTML = txt;
            document.getElementById('title-all-books').innerHTML = ALL_BOOKS + ' (' + dataBooks.length + ')';
        }

        function displayLibraries() {
            var txt = '';
            txt += '<table border="1">';
            txt += '<tr><th>ID</th><th>Name</th><th>Address</th><th># Books</th></tr>';
            var i = 0;
            for (x in dataLibrary) {
                txt += `<tr><td>${dataLibrary[x].id}</td><td>${dataLibrary[x].name}</td><td>${dataLibrary[x].street}, ${dataLibrary[x].city} ${dataLibrary[x].postalCode}</td><td align="right">${dataLibrary[x].totalBooks}</td></tr>`;
                i++;
            }
            txt += '</table>';
            document.getElementById('libraries').innerHTML = txt;
            document.getElementById('title-all-libraries').innerHTML = ALL_LIBRARIES + ' (' + dataLibrary.length + ')';
        }

        function displayAuthors() {
            var txt = '';
            txt += '<table border="1">';
            txt += '<tr><th>ID</th><th>Name</th><th>Gender</th><th>Language</th><th># Books Published</th></tr>';
            var i = 0;
            for (x in dataAuthor) {
                txt += `<tr><td>${dataAuthor[x].id}</td><td>${dataAuthor[x].firstName} ${dataAuthor[x].lastName}</td><td>${dataAuthor[x].gender}</td><td>${dataAuthor[x].language.join(', ')}</td><td align="right">${dataAuthor[x].booksPublished}</td></tr>`;
                i++;
            }
            txt += '</table>';
            document.getElementById('authors').innerHTML = txt;
            document.getElementById('title-all-authors').innerHTML = ALL_AUTHORS + ' (' + dataAuthor.length + ')';
        }

        function displayLibraryBooks() {
            var txt = '';
            txt += '<table border="1">';
            txt += '<tr><th>ID</th><th>Library Name</th><th>Book Name</th></tr>';
            var i = 0;
            for (x in dataLibraryBook) {
                let libraryName = dataLibrary[dataLibraryBook[x].libraryId - 1].name;
                let bookName = dataBooks[dataLibraryBook[x].bookId - 1].title;
                
                txt += `<tr><td>${dataLibraryBook[x].id}</td><td>${libraryName}</td><td>${bookName}</td></tr>`;
                i++;
            }
            txt += '</table>';
            document.getElementById('library-books').innerHTML = txt;
            document.getElementById('title-all-library-books').innerHTML = ALL_BOOKS_IN_LIBRARIES + ' (' + dataLibraryBook.length + ')';
        }

        function validateInputFields() {
            for (var i = 0; i < arguments.length; i++) {
                if (arguments[i] == '') {
                    alert('VALIDATON ERROR AT (' + i + ') \nInput field(s) must be filled out');
                    return false;
                }
            }
            return true;
        }

        function onAddBook() {
            var validated = validateInputFields(inputBookTitle.value, parseInt(inputBookYear.value));
            var notificationText = '';
            if (!validated) {
                notificationText = 'Validations have failed.'
            } else {
                dataBooks.push({
                    id: dataBooks.length + 1,
                    title: inputBookTitle.value,
                    author: [],
                    classification: [],
                    yearPublished: inputBookYear.value
                });

                clearTextfields();
                notificationText = 'The book has been added to the dataset.'
                displayBooks();
            }
            notifications.innerHTML = notificationText;
        }

        function onSaveBook() {
            var validated = validateInputFields(inputBookTitle.value, parseInt(inputBookYear.value));
            var notificationText = '';
            if (!validated) {
                notificationText = 'Validations have failed.'
            } else {
                dataBooks[editIndex].title = inputBookTitle.value;
                dataBooks[editIndex].yearPublished = inputBookYear.value;
                toggleVisibility(btnAddBook);
                toggleVisibility(btnSaveBook);
                toggleVisibility(btnCancelBook);
                clearTextfields();
                notificationText = 'The book data has been updated.'
                displayBooks();
            }
            notifications.innerHTML = notificationText;
        }

        function onCancelBook(index) {
            toggleVisibility(btnAddBook);
            toggleVisibility(btnSaveBook);
            toggleVisibility(btnCancelBook);
            clearTextfields();
        }

        function onDeleteBook(index) {
            if (dataBooks.length > 0) {
                if (confirm("Are you sure you want to delete?")) {
                    dataBooks.splice(index, 1);
                    notificationText = 'The book has been added to the dataset.'
                    displayBooks();
                    notifications.innerHTML = notificationText;
                } else {
                    // You pressed Cancel;
                }
            }
        }

        function onEditBook(index) {
            clearTextfields();
            var inputBookTitle = document.getElementById('input-book-title');
            var inputBookYear = document.getElementById('input-book-year');
            inputBookTitle.value = dataBooks[index].title;
            inputBookYear.value = dataBooks[index].yearPublished;
            editIndex = index;
            toggleVisibility(btnAddBook);
            toggleVisibility(btnSaveBook);
            toggleVisibility(btnCancelBook);
        }

        function clearTextfields() {
            inputBookTitle.value = '';
            inputBookYear.value = '';
            notifications.innerHTML = '';
            editIndex = -1;
        }

        function toggleVisibility(x) {
            if (x.style.display === 'none') {
                x.style.display = 'inline';
            } else {
                x.style.display = 'none';
            }
        }

// Create dataset
        // Setup the initial dataset with 2 libraries, 4 authors, 12 books and 6 of these books are in both libraries.
        var dataLibrary = [{
            id: 1,
            name: 'Toronto Public Library - Brookbanks Branch',
            street: '210 Brookbanks Dr',
            city: 'North York, ON',
            postalCode: 'M3A 2T8',
            totalBooks: 12
        },
        {
            id: 2,
            name: 'Toronto Public Library - Pleasant View Branch',
            street: '575 Van Horne Ave',
            city: 'Toronto, ON',
            postalCode: 'M2J 4S8',
            totalBooks: 6
        }
        ];

        var dataAuthor = [{
            id: 1,
            firstName: 'Craig',
            lastName: 'Walls',
            gender: 'M',
            language: ['English'],
            booksPublished: 3
        },
        {
            id: 2,
            firstName: 'Matthew',
            lastName: 'Carver',
            gender: 'M',
            language: ['English', 'French'],
            booksPublished: 3
        },
        {
            id: 3,
            firstName: 'Ola',
            lastName: 'Ellnestam',
            gender: 'F',
            language: ['English', 'French'],
            booksPublished: 4
        },
        {
            id: 4,
            firstName: 'Aleksandar',
            lastName: 'Nikolic',
            gender: 'M',
            language: ['English'],
            booksPublished: 3
        }
        ];

        var dataBooks = [{
            id: 1,
            title: 'Spring in Action, Fourth Edition',
            author: [1, 3],
            classification: ['Java'],
            yearPublished: 2013
        },
        {
            id: 2,
            title: 'The Mikado Method',
            author: [1],
            classification: ['Computers', 'Databases', 'Data Mining'],
            yearPublished: 2011
        },
        {
            id: 3,
            title: 'The Responsive Web',
            author: [1],
            classification: ['Web'],
            yearPublished: 2009
        },
        {
            id: 4,
            title: 'Fast ASP.NET Websites',
            author: [2],
            classification: ['Backend'],
            yearPublished: 2013
        },
        {
            id: 5,
            title: 'SBT in Action',
            author: [2],
            classification: ['Computers'],
            yearPublished: 2016
        },
        {
            id: 6,
            title: 'PowerShell Deep Dives',
            author: [2],
            classification: ['Computers'],
            yearPublished: 2017
        },
        {
            id: 7,
            title: 'Gradle in Action',
            author: [3],
            classification: ['Computers'],
            yearPublished: 2009
        },
        {
            id: 8,
            title: 'Scalatra in Action',
            author: [3],
            classification: ['Computers'],
            yearPublished: 2009
        },
        {
            id: 9,
            title: 'AngularJS in Action',
            author: [3],
            classification: ['Frontend', 'JavaScript'],
            yearPublished: 2011
        },
        {
            id: 10,
            title: 'Software Development Metrics',
            author: [4],
            classification: ['Computers'],
            yearPublished: 2014
        },
        {
            id: 11,
            title: 'F# Deep Dives',
            author: [4],
            classification: ['Computers'],
            yearPublished: 2018
        },
        {
            id: 12,
            title: 'C# in Depth, Third Edition',
            author: [4],
            classification: ['Computers'],
            yearPublished: 2013
        }
        ];

        var dataLibraryBook = [{
            id: 1,
            libraryId: 1,
            bookId: 1
        },{
            id: 2,
            libraryId: 2,
            bookId: 3
        },{
            id: 3,
            libraryId: 1,
            bookId: 2
        },{
            id: 4,
            libraryId: 1,
            bookId: 3
        },{
            id: 5,
            libraryId: 2,
            bookId: 2
        },{
            id: 6,
            libraryId: 2,
            bookId: 1
        },{
            id: 7,
            libraryId: 1,
            bookId: 4
        },{
            id: 8,
            libraryId: 1,
            bookId: 5
        },{
            id: 9,
            libraryId: 1,
            bookId: 6
        },{
            id: 10,
            libraryId: 1,
            bookId: 7
        },{
            id: 11,
            libraryId: 2,
            bookId: 4
        },{
            id: 12,
            libraryId: 2,
            bookId: 5
        },{
            id: 13,
            libraryId: 2,
            bookId: 6
        },{
            id: 14,
            libraryId: 1,
            bookId: 8
        },{
            id: 15,
            libraryId: 1,
            bookId: 9
        },{
            id: 16,
            libraryId: 1,
            bookId: 10
        }]
// End create dataset

    </script>
</body>

</html>